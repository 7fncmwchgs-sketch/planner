<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>سجل الفنون التشكيلية 2026 - الإصدار التفاعلي</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@400;700;900&family=Mrs+Saint+Delafield&display=swap" rel="stylesheet" />
  <style>
    :root {
      --vintage-paper: #fdfaf3;
      --royal-navy: #1a2e44;
      --antique-gold: #9d7e3d;
      --deep-ruby: #631d1d;
      --line-tan: #e5dcc5;
      --salary-green: #2d5a27;
      --weekend-bg: #f0f2f5;
    }

    @media print {
      .no-print { display: none !important; }
      body { background: white !important; padding: 0 !important; }
      .spread-container { page-break-after: always !important; display: flex !important; }
      @page { size: A4 landscape; margin: 0; }
    }

    body {
      background: #334155;
      font-family: 'Amiri', serif;
      margin: 0;
      padding: 20px;
      scroll-behavior: smooth;
    }

    /* شريط الأدوات العائم */
    .dashboard {
      position: sticky;
      top: 10px;
      z-index: 1000;
      max-width: 900px;
      margin: 0 auto 30px;
      background: rgba(255, 255, 255, 0.95);
      padding: 15px;
      border-radius: 15px;
      text-align: center;
      border: 3px double var(--antique-gold);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .btn-premium {
      background: var(--royal-navy);
      color: #fff;
      border: 2px solid var(--antique-gold);
      padding: 10px 18px;
      cursor: pointer;
      font-family: 'Cairo', sans-serif;
      font-weight: 700;
      border-radius: 8px;
      transition: 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .btn-premium:hover { background: var(--antique-gold); color: var(--royal-navy); }
    .btn-premium input[type="file"] { display: none; }

    .preview-row { display: flex; justify-content: center; align-items: center; gap: 14px; margin-top: 8px; flex-wrap: wrap; }

    .spread-container { display: flex; justify-content: center; gap: 0; margin-bottom: 40px; }

    /* كل صفحة منفصلة داخل الانتشار */
    .page-container {
      width: 148.5mm; /* نصف A4 "Landscape" */
      height: 210mm;
      background: var(--vintage-paper);
      padding: 8mm;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      position: relative;
      border: 1px solid #d1c7a7;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid var(--antique-gold);
      margin-bottom: 5px;
      gap: 10px;
    }

    .initials-logo {
      font-family: 'Mrs Saint Delafield', cursive;
      font-size: 35px;
      color: var(--antique-gold);
      border: 2px solid var(--antique-gold);
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: var(--royal-navy);
    }

    /* أماكن الصور في الترويسة */
    .ministry-logo,
    #logo-preview {
      height: 38px;
      width: auto;
      border: 1px dashed var(--antique-gold);
      background: #fff;
      padding: 2px;
      border-radius: 6px;
      object-fit: contain;
    }

    .user-photo,
    #photo-preview {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      border: 2px solid var(--antique-gold);
      object-fit: cover;
      background: #fff;
    }

    .date-badge {
      text-align: center;
      background: white;
      border: 2px solid var(--royal-navy);
      border-radius: 8px;
      min-width: 70px;
      cursor: pointer;
    }
    .date-month { background: var(--deep-ruby); color: white; font-size: 11px; padding: 2px; }
    .date-day { font-size: 28px; font-weight: 900; color: var(--royal-navy); line-height: 1; }

    .day-label {
      background: var(--antique-gold);
      color: white;
      font-family: 'Cairo', sans-serif;
      font-size: 14px;
      padding: 2px 15px;
      border-radius: 15px 15px 0 0;
      display: inline-block;
      margin-top: 5px;
    }

    .horizontal-schedule { width: 100%; border-collapse: collapse; margin-top: 5px; }
    .horizontal-schedule th {
      background: var(--royal-navy);
      color: white;
      font-size: 10px;
      border: 1px solid var(--antique-gold);
      padding: 6px 2px;
    }
    .horizontal-schedule td { border: 1px solid var(--antique-gold); height: 35px; background: white; text-align: center; }

    .section-header {
      background: var(--royal-navy);
      color: var(--antique-gold);
      padding: 4px 10px;
      font-family: 'Cairo', sans-serif;
      font-size: 12px;
      font-weight: bold;
      border-right: 5px solid var(--antique-gold);
      margin: 8px 0;
    }

    .notes-area { flex: 1; background: white; border: 1px solid #d1c7a7; padding: 5px; position: relative; }
    .lines { background-image: repeating-linear-gradient(transparent, transparent 27px, var(--line-tan) 28px); line-height: 28px; height: 100%; }

    /* التفاعل في التقويم الصغير */
    .mini-cal-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 10px; }
    .mini-month { border: 1px solid var(--antique-gold); background: white; font-size: 8px; text-align: center; }
    .mini-month-title { background: var(--royal-navy); color: var(--antique-gold); padding: 2px; font-size: 9px; cursor: pointer; }
    .mini-month td { cursor: pointer; transition: 0.2s; }
    .mini-month td:hover:not(:empty) { background: var(--antique-gold) !important; color: white !important; }

    .day-event { background: var(--deep-ruby) !important; color: white !important; border-radius: 2px; font-weight: bold; }
    .day-salary { background: var(--salary-green) !important; color: white !important; border-radius: 2px; }
    .day-weekend { background: var(--weekend-bg); color: #bbb; }

    .signature-fluid { font-family: 'Mrs Saint Delafield', cursive; font-size: 42px; color: var(--royal-navy); opacity: 0.8; transform: rotate(-5deg); }

    .finance-table { width: 100%; border-collapse: collapse; flex: 1; }
    .finance-table th { background: var(--royal-navy); color: white; font-size: 11px; border: 1px solid var(--antique-gold); padding: 8px; }
    .finance-table td { border: 1px solid var(--antique-gold); background: white; height: 30px; }

    footer { border-top: 1px solid var(--antique-gold); padding-top: 5px; margin-top: auto; font-size: 11px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; color: var(--royal-navy); }
    .event-text { color: var(--deep-ruby); font-weight: bold; }
  </style>
</head>
<body>
  <div class="dashboard no-print">
    <h2 style="font-family:'Cairo'; color:var(--royal-navy); margin:0 0 10px 0;">سجل الفنون التشكيلية التفاعلي 2026</h2>

    <div style="display:flex; justify-content:center; gap:10px; flex-wrap:wrap;">
      <button class="btn-premium" onclick="generate()">توليد السجل وتفعيل الانتقال</button>
      <button class="btn-premium" style="background:var(--deep-ruby)" onclick="window.print()">طباعة السجل PDF</button>

      <!-- أزرار تحميل الصور المحلية -->
      <label class="btn-premium" title="تحميل شعار الوزارة">
        تحميل شعار الوزارة
        <input id="logo-input" type="file" accept="image/*" />
      </label>

      <label class="btn-premium" title="تحميل الصورة الشخصية">
        تحميل الصورة الشخصية
        <input id="photo-input" type="file" accept="image/*" />
      </label>
    </div>

    <!-- معاينات فورية -->
    <div class="preview-row">
      <div style="display:flex; align-items:center; gap:8px;">
        <span style="font-family:'Cairo'; font-weight:700; color:var(--royal-navy);">معاينة الشعار:</span>
        <img id="logo-preview" alt="معاينة الشعار" />
      </div>
      <div style="display:flex; align-items:center; gap:8px;">
        <span style="font-family:'Cairo'; font-weight:700; color:var(--royal-navy);">معاينة الصورة:</span>
        <img id="photo-preview" alt="معاينة الصورة" />
      </div>
    </div>

    <p style="font-size:12px; margin-top:10px;">* اضغط على أي تاريخ في التقاويم الصغيرة للانتقال السريع لصفحة اليوم.</p>
  </div>

  <div id="print-area"></div>

  <script>
    // أحداث ثابتة (يناير إلى يونيو)
    const events = {
      "1-11": "مناسبة: ذكرى تولي جلالة السلطان هيثم بن طارق المعظم",
      "1-15": "مناسبة: ذكرى الإسراء والمعراج",
      "2-1": "حدث: بداية الفصل الدراسي الثاني",
      "2-24": "مناسبة: يوم المعلم العماني",
      "3-1": "حدث: بداية شهر رمضان المبارك (تقديرياً)",
      "3-30": "مناسبة: عيد الفطر السعيد (تقديرياً)"
      // "7-1": "حدث: بدء إجازة الكادر الإداري والتدريسي" // تم استبعاده مع حذف يوليو
    };

    // الأشهر المتاحة
    const monthNames = ["يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو"];

    // الحصص 
    const scheduleTimes = [
      "7:35 ص - 8:15 ص",
      "8:20 ص - 9:00 ص",
      "9:05 ص - 9:45 ص",
      "9:50 ص - 10:30 ص",
      "الفسحة",
      "10:55 ص - 11:35 ص",
      "11:40 ص - 12:20 م",
      "12:25 م - 1:05 م",
      "1:10 م - 1:50 م",
    ];

    // صور الشعار والصورة الشخصية من LocalStorage
    let ministryLogoDataUrl = localStorage.getItem("ministryLogo") || "";
    let userPhotoDataUrl = localStorage.getItem("userPhoto") || "";

    function scrollToId(id) {
      const el = document.getElementById(id);
      if (el) el.scrollIntoView({ behavior: "smooth", block: "center" });
    }

    // يوم الراتب (23 أو 21 إذا صادف جمعة/سبت)
    function getSalaryDay(m) {
      let d = new Date(2026, m, 23);
      return d.getDay() === 5 || d.getDay() === 6 ? 21 : 23;
    }

    // توليد تقويم صغير لشهر m
    function buildMiniCal(m) {
      let html = `<div class="mini-month">
        <div class="mini-month-title" onclick="scrollToId('month-fin-${m}')">${monthNames[m]}</div>
        <table style="width:100%; border-collapse:collapse;"><tr>`;

      ["ح", "ن", "ث", "ر", "خ", "ج", "س"].forEach(
        (d) => (html += `<td style="font-weight:bold; font-size:7px;">${d}</td>`)
      );
      html += `</tr>`;

      const days = new Date(2026, m + 1, 0).getDate();
      const first = new Date(2026, m, 1).getDay();
